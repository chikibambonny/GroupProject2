import sounddevice as sd
import vosk
import queue
import json

# ========= CONFIG =========
eng_model_path = r"sign_language\models\vosk-model-small-en-us-0.15"



# Queue to hold audio chunks
q = queue.Queue()

# Load the Vosk model
model = vosk.Model(eng_model_path) 
recognizer = vosk.KaldiRecognizer(model, 16000)

# Callback function to put microphone data into the queue
def callback(indata, frames, time, status):
    if status:
        print(status)
    q.put(bytes(indata))

# Open the microphone stream
with sd.RawInputStream(samplerate=16000, blocksize=8000, dtype='int16',
                       channels=1, callback=callback):
    print("Listening... Press Ctrl+C to stop.")
    try:
        while True:
            data = q.get()
            if recognizer.AcceptWaveform(data):
                result = json.loads(recognizer.Result())
                print(">>", result.get("text", ""))
            else:
                partial = json.loads(recognizer.PartialResult())
                print("\r" + partial.get("partial", ""), end="")
    except KeyboardInterrupt:
        print("\nStopped.")
